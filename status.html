<!DOCTYPE html>
<html>
<head>
  <title>ACT Truck</title>
<meta charset=”UTF-8″ />
<link rel="shortcut icon" href="images/act-seal-logo1.png" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- <link rel="stylesheet" type="text/css" href="css/searcher.css"> -->
<link rel="stylesheet" type="text/css" href="css/stylosmobile.css">

     <div id="output"></div> <!--BORRAR-->
    <script src="Scripts/jquery.min.js"></script>
    <script>
        function showin(ref) {
            document.getElementById(ref).style.opacity = '1';
        }

        function showandmove(ref) {

            document.getElementById('controles').style.opacity = '0';
            document.getElementById('resumen').style.opacity = '0';

            document.getElementById(ref).style.opacity = '1';
            document.getElementById(ref).style.padding = '0';
        }

        function bodyonload() {
            showin("mainStatusLine");
            //Aca se verifica si ya se tiene asociado un cupo o se permite al usuario asociar su patente.
            alert("localStorage" + localStorage);
            if (localStorage == null) {
                //se muestra el form para sociar un cupo nuevo.
                showandmove("controles");
            }
            else {
                                        var patente = localStorage.getItem("PATENTE");
                                        var dsPuerto = localStorage.getItem("PUERTO");
                                        var fechaCupo = localStorage.getItem("FECHACUPO");
                                        var nroCupo = localStorage.getItem("CODIGO");
                                        var dsEstado = "";
                                        alert("localStorage.getItem(CODIGO)" + localStorage.getItem("CODIGO"));
          
                                        if (localStorage.getItem("CODIGO") == null) {
                                            //se muestra el form para sociar un cupo nuevo.
                                            showandmove("controles");
                                        } else {
                                            //Tiene asociado un cupo
                                            document.getElementById("nroCupo").innerHTML = nroCupo;
                                            document.getElementById("fechaCupo").innerHTML = fechaCupo;
                                            document.getElementById("puerto").innerHTML = dsPuerto;
                                            document.getElementById("patente").innerHTML = patente;
                                            showandmove("resumen");
                                            document.getElementById("txtCupo").value = "";
                                            document.getElementById("txtPatente").value = "";
                                        }
                 }
        }
    </script>
    
      <script type="text/javascript" language="javascript">

          $(document).ready(function () {
              bodyonload();
          });
    </script>

    <script type="text/javascript" language="javascript">
        function PedirCupo(oCodigoIn, oPatenteIn) {

            if (oCodigoIn == null || oCodigoIn.length == 0 || /^\s+$/.test(oCodigoIn)) {
                alert("Debe poner algun Valor en el Codigo");
                return;
            }
            if (oPatenteIn == null || oPatenteIn.length == 0 || /^\s+$/.test(oPatenteIn)) {
                alert("Debe poner algun Valor en la Patente");
                return;
            }


//            if ( (?i:[A-Z]{3})[0-9]{3}.test(oPatenteIn)) {
//                alert("Patente Invalida");
//                return;
//            }
//         

            var patron = /^[0-9]{3}[a-z]{3}$/;
            if (patron.test(oPatenteIn))
                alert('La patente ingresada es correcta');
            else
                alert('La patente ingresada no es correcta');



//            for (var i = 0; i < oCodigoIn.length; i++) {

//                var valor = oCodigoIn.substring(i, i + 1);

//                if (!isNaN(valor)) {
//                    alert("Numero:" + valor);
//                }
//                else {
//                    alert("Letra:" + valor);
//                }
//            }


//            alert("Busca Solo UnoX" + oCodigoIn);




            $('#output').html($("#txtname").val());
            // Add the page method call as an onclick handler for the div.
            var mydata = {
                oCodigo: oCodigoIn,
                oPatente: oPatenteIn
              }
            alert(JSON.stringify(mydata));
            //var ourl = "http://localhost:64858/Controller.aspx/TBLCUPOSNOMINADOS_GET_BY_CODIGO_Json";
            //url: "http://localhost/CuposCamiones/CupoCamiones.asmx/TBLCUPOSNOMINADOS_GET_BY_CODIGO_Json",
            //var ourl = "http://localhost:64858/Controller.aspx/AsignarCupoCamion";
            var ourl = "http://www.toepfer.com.ar/merws/Controller.aspx/AsignarCupoCamion";
            $.ajax({


                url: ourl,

                type: "POST",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                //data: "{}",
                //data: "{ oCodigo: " + oCodigoIn + " }",

                data: JSON.stringify(mydata),

                success:
                                         function (data, textStatus, XMLHttpRequest) {
                                             alert("data.dddd" + data.d);
                                             $('#output').html(data.d);

                                             $("#contenido").html('');

                                             /* Vemos que la respuesta no este vacía y sea una arreglo */

                                             // if(data != null && $.isArray(data)){
                                             if (data != null) {


                                                 //var json = $.parseJSON(data.d);
                                                 var json = JSON.parse(data.d);
                                                 alert("json" + json.CODIGO);
                                                 $("#contenido").append("<tr><td>" + json.CODIGO + "</td><td>" + json.FECHACUPO + "</td><td>" + json.PUERTO + "</td></tr>");

                                                 alert("typeof (Storage) :" + typeof (Storage));
                                                 if (typeof (Storage) !== "undefined") {
                                                     alert("!==  : 1");
                                                     localStorage.setItem("CODIGO", json.CODIGO);
                                                     localStorage.setItem("FECHACUPO", json.FECHACUPO);
                                                     localStorage.setItem("PUERTO", json.PUERTO);
                                                     localStorage.setItem("PATENTE", json.PATENTE);
                                                     alert("!==  : 2");
                                                     bodyonload();
                                                 } else {
                                                     alert('Sorry! No Web Storage support..!');

                                                 }



                                             }
                                             else {
                                                 alert('data null');

                                             }


                                         },

                failure: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(textStatus);
                }

            });
        }

        function LiberarCupo() {
            alert("LiberarCupo" );
            //alert("LiberarCupo" + oCodigoIn);
            localStorage.clear();
            bodyonload();
        }

        function PedirCupo2(oCodigoIn) {

            //alert("PedirCupo2" + oCodigoIn);


            $('#output').html($("#txtname").val());
            // Add the page method call as an onclick handler for the div.
            var mydata = {
                oCodigo: oCodigoIn//,
                //name: $("#txtname").val(),
                //email: $("#txtemail").val()

            }
            //alert("XXXXX" + JSON.stringify(mydata));


            //var ourl = "http://localhost/CuposCamiones/CupoCamiones.asmx/TBLCUPOSNOMINADOS_GET_BY_CODIGO_Json";
            //var ourl = "http://localhost:64858/CupoCamiones.asmx/TBLCUPOSNOMINADOS_GET_BY_CODIGO_JsonBorrar";
            var ourl = "http://www.toepfer.com.ar/merws/Controller.aspx/TBLCUPOSNOMINADOS_GET_BY_CODIGO_JsonBorrar";

            var request = $.ajax({

                url: ourl,

                type: "POST",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                //data: "{}",
                data: "{ oCodigo: 6300012 }",











                //jsonpCallback: function (data, textStatus, XMLHttpRequest) {
                //    //alert("data.d" + data.d);
                //},
                success: function (data) {
                    alert("data.d" + data.d);


                },




                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert("Error : " + textStatus + ": " + XMLHttpRequest.responseText + ": " + errorThrown);



                },


                always: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert("always");
                }



            })

            ;




        }


    </script>

</head>
<body  >
    <header>
        <!--<h1>City Gallery</h1>-->
        <div id="logodiv" class="logo-center">
            <img src="images/act-logo-small.png">
            	<hr id="mainStatusLine" class="fade" />	
        </div>
    </header>

	
		
	    <section>
        <p>
	<div id="resumen" class="resumen-center fade">		
		<form name="frmSel"  method="post" autocomplete="off">
			<ul>
				<li class="li-titulo">N&uacute;mero de Cupo</li>
				<li class="li-valor"><div id="nroCupo"></div></li>
				<li class="li-titulo">Fecha Cupo</li>
				<li class="li-valor"><div id="fechaCupo"></div></li>
				<li class="li-titulo">Planta</li>
				<li class="li-valor"><div id="puerto"></div></li>
				<li class="li-titulo">Patente</li>				
				<li class="li-valor"><div id="patente"></div></li>
				
			</ul>
			<button   type="button" class="input-cupo" onclick="LiberarCupo(txtCupo.value)" value="LIBERAR CUPO">LIBERAR CUPO </button>
           
                 <button class="inputstatus" type="button" onclick="LiberarCupo()">Liberar Cupo3</button>

			<input id="txtCupo" type="hidden" name="txtCupo"  />							
			<input id="txtPatente" type="hidden" name="txtPatente"  />					
		</form>
	</div>
    </p>



     <p>
	<div id="controles" class="control-center fade">		
		<form name="frmSel" method="post"  id="searchfilter" autocomplete="off">
			<input class="input-cupo" maxlength="10" id="txtCupo" type="text" name="txtCupo" placeholder="C&oacute;digo de Cupo" />							
			<input class="input-cupo" maxlength="10" id="txtPatente" type="text" name="txtPatente" placeholder="Patente" />		

			<button class="main-menu-item" maxlength="10" type="button" class="inputstatus"  onclick="PedirCupo(txtCupo.value, txtPatente.value)"  value="REGISTRAR">REGISTRAR</button>
             
		</form>
	</div>

    </p>


  </section>
</body>
</html>
